ALTER TABLE BSITSQP.DEVICE_INFO
 DROP PRIMARY KEY CASCADE;

DROP TABLE BSITSQP.DEVICE_INFO CASCADE CONSTRAINTS;

CREATE TABLE BSITSQP.DEVICE_INFO
(
  ID                      VARCHAR2(10 BYTE),
  DEVICE_ID               VARCHAR2(50 BYTE)     NOT NULL,
  DEVICE_NAME             VARCHAR2(300 BYTE),
  DEVICE_FIRM             VARCHAR2(200 BYTE),
  DEVICE_AREA             VARCHAR2(200 BYTE),
  MONITOR_TYPE            VARCHAR2(50 BYTE),
  DEVICE_MODEL            VARCHAR2(100 BYTE),
  POINT_NAME              VARCHAR2(200 BYTE),
  IPV4                    VARCHAR2(15 BYTE),
  IPV6                    VARCHAR2(200 BYTE),
  MAC                     VARCHAR2(100 BYTE),
  CAMERA_TYPE             VARCHAR2(15 BYTE),
  CAMERA_FUNC_TYPE        VARCHAR2(15 BYTE),
  FILL_LIGHT_ATTR         VARCHAR2(15 BYTE),
  CAMERA_NUM_FORMAT       VARCHAR2(15 BYTE),
  STORAGE_DEVICE_IP       VARCHAR2(15 BYTE),
  STORAGE_DEVICE_CHAN     VARCHAR2(50 BYTE),
  INSTALL_ADDRESS         VARCHAR2(300 BYTE),
  LONGITUDE               VARCHAR2(50 BYTE),
  LATITUDE                VARCHAR2(50 BYTE),
  CAMERA_POSITION_TYPE    VARCHAR2(100 BYTE),
  MONITORING_DIRECTION    VARCHAR2(20 BYTE),
  CAMERA_IMAGE_URL        VARCHAR2(255 BYTE),
  NETWORK_ATTR            VARCHAR2(20 BYTE),
  DEVICE_AREA_NUM         VARCHAR2(50 BYTE),
  INSTALL_TIME            DATE,
  DEVICE_ORG              VARCHAR2(100 BYTE),
  INFORMATION             VARCHAR2(20 BYTE),
  SAVE_DAYS               NUMBER,
  DEVICE_STATUS           VARCHAR2(10 BYTE),
  SUB_DEPARTMENT          VARCHAR2(100 BYTE),
  VIDEO_RESOLUTION_RATIO  VARCHAR2(10 BYTE),
  VIDEO_SIGNAL_TYPE       VARCHAR2(10 BYTE),
  IS_EXTERNAL             VARCHAR2(10 BYTE),
  IS_JOIN_PLAT            VARCHAR2(10 BYTE),
  KEY_NUM                 VARCHAR2(50 BYTE),
  USE_TYPE                VARCHAR2(100 BYTE),
  INSTALL_HEIGHT          NUMBER,
  VISUAL_DISTANCE         NUMBER,
  EXT1                    VARCHAR2(255 BYTE),
  EXT2                    VARCHAR2(255 BYTE),
  EXT3                    VARCHAR2(255 BYTE),
  DEVICE_USERNAME         VARCHAR2(255 BYTE),
  DEVICE_PASSWORD         VARCHAR2(255 BYTE)
)
TABLESPACE BSITSQP
RESULT_CACHE (MODE DEFAULT)
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          6M
            NEXT             1M
            MAXSIZE          UNLIMITED
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.ID IS '序号（数字或字母）';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.DEVICE_ID IS '设备ID（默认20位数字）';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.DEVICE_NAME IS '设备名称';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.DEVICE_FIRM IS '设备厂商';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.DEVICE_AREA IS '行政区划';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.MONITOR_TYPE IS '监控点类型';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.DEVICE_MODEL IS '设备型号';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.POINT_NAME IS '点位俗称';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.IPV4 IS 'IPV4地址';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.IPV6 IS 'IPV6地址';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.MAC IS 'MAC地址';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.CAMERA_TYPE IS '摄像机类型';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.CAMERA_FUNC_TYPE IS '摄像机功能类型';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.FILL_LIGHT_ATTR IS '补光属性';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.CAMERA_NUM_FORMAT IS '摄像机编码格式类型';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.STORAGE_DEVICE_IP IS '对于存储IP';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.STORAGE_DEVICE_CHAN IS '对应存储设备通道';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.INSTALL_ADDRESS IS '安装地址';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.LONGITUDE IS '经度';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.CAMERA_POSITION_TYPE IS '摄像机位置类型';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.MONITORING_DIRECTION IS '监视方向';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.CAMERA_IMAGE_URL IS '摄像机场景预设照片URL';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.NETWORK_ATTR IS '联网属性';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.DEVICE_AREA_NUM IS '所属辖区公安机关';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.INSTALL_TIME IS '安装时间';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.DEVICE_ORG IS '管理单位';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.INFORMATION IS '管理单位联系方式';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.SAVE_DAYS IS '录像保存天数';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.DEVICE_STATUS IS '设备状态';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.SUB_DEPARTMENT IS '设备所属部门';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.VIDEO_RESOLUTION_RATIO IS '视频分辨率';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.VIDEO_SIGNAL_TYPE IS '视频信号类型';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.IS_EXTERNAL IS '是否对外共享';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.IS_JOIN_PLAT IS '是否接入三级平台';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.KEY_NUM IS '键盘编号';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.USE_TYPE IS '建设应用类别';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.INSTALL_HEIGHT IS '安装高度（单位米）';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.VISUAL_DISTANCE IS '可视距离（单位米）';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.EXT1 IS '扩展字段1(进沪、出沪标识)（进沪为1、出沪为 2）';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.EXT2 IS '扩展字段2(检查站标识符号)';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.EXT3 IS '扩展字段3(设备车道编号)';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.DEVICE_USERNAME IS '设备登录名称';

COMMENT ON COLUMN BSITSQP.DEVICE_INFO.DEVICE_PASSWORD IS '设备登录密码';



--  There is no statement for index BSITSQP.SYS_C00114251.
--  The object is created when the parent object is created.

CREATE OR REPLACE TRIGGER BSITSQP.DEVICE_INFO_TRIGGER
  after insert or update or delete ON BSITSQP.DEVICE_INFO
  FOR EACH ROW
DECLARE
  lx varchar2(50);
BEGIN    
  IF (inserting and :new.longitude is not null and :new.latitude is not null AND :new.LONGITUDE<>0 AND :new.LATITUDE<>0) THEN
    --摄像机类型
    select dmxmc into lx from B_QJ_DMX t where dmlxxh='30000' and dmxz=:new.CAMERA_TYPE;
    insert into VIDEO_INFO@SDELINK
      (sbbh,
       name,
       qy,
       type_,
       fx,
       fradius,
       sradius,
       range,
       jpm,
       x,
       y,
       sblb)
    values
      (:new.DEVICE_ID,
       :new.DEVICE_NAME,
       :new.DEVICE_ORG,
       lx,
       :new.MONITORING_DIRECTION,
       60,
       120,
       60,
       :new.KEY_NUM,
       :new.LONGITUDE,
       :new.LATITUDE,
       :new.use_type);
  ELSIF deleting THEN
    delete from VIDEO_INFO@SDELINK where sbbh = :old.device_id;
  ELSIF updating THEN
    --摄像机类型
    select dmxmc into lx from B_QJ_DMX t where dmlxxh='30000' and dmxz=:new.CAMERA_TYPE;
    update VIDEO_INFO@SDELINK
       set name  = :new.DEVICE_NAME,
           qy    = :new.DEVICE_ORG,
           type_ = lx,
           fx    = :new.MONITORING_DIRECTION,
           jpm   = :new.KEY_NUM,
/*           x     = :new.LONGITUDE,
           y     = :new.LATITUDE,*/
           sblb  = :new.use_type
     where sbbh = :old.DEVICE_ID;
  END IF;
END;
/


ALTER TABLE BSITSQP.DEVICE_INFO ADD (
  PRIMARY KEY
  (DEVICE_ID)
  USING INDEX
    TABLESPACE BSITSQP
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MAXSIZE          UNLIMITED
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                PCTINCREASE      0
                BUFFER_POOL      DEFAULT
                FLASH_CACHE      DEFAULT
                CELL_FLASH_CACHE DEFAULT
               )
  ENABLE VALIDATE);

GRANT ALTER, DELETE, INDEX, INSERT, REFERENCES, SELECT, UPDATE, ON COMMIT REFRESH, QUERY REWRITE, DEBUG, FLASHBACK ON BSITSQP.DEVICE_INFO TO VIAS WITH GRANT OPTION;

GRANT ALTER, DELETE, INDEX, INSERT, REFERENCES, SELECT, UPDATE, ON COMMIT REFRESH, QUERY REWRITE, DEBUG, FLASHBACK ON BSITSQP.DEVICE_INFO TO VIID WITH GRANT OPTION;
